<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			
			.mini {
				display: none;
				width: 98px;
				border: 1px solid #000;
				height: 98px;
				position: absolute;
				line-height: 98px;
				font-size: 50px;
				text-align: center;
			}
			
			.box {
				width: 400px;
				height: 400px;
				border: 1px solid #000;
				position: relative;
			}
			
			#box2 {
				left: 100px;
			}
			
			#box3 {
				left: 200px;
			}
			
			#box4 {
				left: 300px;
			}
			
			#box5 {
				top: 100px;
			}
			
			#box6 {
				top: 100px;
				left: 100px;
			}
			
			#box7 {
				top: 100px;
				left: 200px;
			}
			
			#box8 {
				top: 100px;
				left: 300px;
			}
			
			#box9 {
				top: 200px;
			}
			
			#box10 {
				top: 200px;
				left: 100px;
			}
			
			#box11 {
				top: 200px;
				left: 200px;
			}
			
			#box12 {
				top: 200px;
				left: 300px;
			}
			
			#box13 {
				top: 300px;
			}
			
			#box14 {
				top: 300px;
				left: 100px;
			}
			
			#box15 {
				top: 300px;
				left: 200px;
			}
			
			#box16 {
				top: 300px;
				left: 300px;
			}
		</style>
	</head>

	<body>
		<div class="box">
			<div class="mini" id="box1"></div>
			<div class="mini" id="box2"></div>
			<div class="mini" id="box3"></div>
			<div class="mini" id="box4"></div>
			<div class="mini" id="box5"></div>
			<div class="mini" id="box6"></div>
			<div class="mini" id="box7"></div>
			<div class="mini" id="box8"></div>
			<div class="mini" id="box9"></div>
			<div class="mini" id="box10"></div>
			<div class="mini" id="box11"></div>
			<div class="mini" id="box12"></div>
			<div class="mini" id="box13"></div>
			<div class="mini" id="box14"></div>
			<div class="mini" id="box15"></div>
			<div class="mini" id="box16"></div>
		</div>
	<script>
		var box = document.getElementsByClassName("mini");

		function rand(min, max) {
			return Math.floor(Math.random() * (max - min + 1) + min)
		}
		var arr1 = new Array(16);
		var arr2 = [2, 4];

		function arrfu() {
			for(var i = 0; i < 16; i++) {
				if(box[i].style.display == "block") {
					arr1[i] = true;
				} else {
					arr1[i] = false;
				}
			}
		}

		function end() {
			arrfu();
			for(var i = 0; i < 16; i++) {
				if(arr1[i] == false) {
					return false;
					break;
				}
			}
			return true;
		}
		document.onkeydown = function(event) {
			if(event.keyCode == 39) {
				keyfor(0,4,1);
				if(end()) {
					alert("game over");
				}else{
					var fif = rand(0, 15);
					while(arr1[fif] == true) {
						var fif = rand(0, 15);
					}
					box[fif].style.display = "block";
					box[fif].innerHTML = arr2[rand(0, 1)];
				}
			}
			if(event.keyCode == 37) {
				keyfor(3,4,-1);
				if(end()) {
					alert("game over");
				}else{
					var fif = rand(0, 15);
					while(arr1[fif] == true) {
						var fif = rand(0, 15);
					}
					box[fif].style.display = "block";
					box[fif].innerHTML = arr2[rand(0, 1)];
				}
			}
			if(event.keyCode == 38) {
				keyfor(12,1,-4);
				if(end()) {
					alert("game over");
				}else{
					var fif = rand(0, 15);
					while(arr1[fif] == true) {
						var fif = rand(0, 15);
					}
					box[fif].style.display = "block";
					box[fif].innerHTML = arr2[rand(0, 1)];
				}
			}
			if(event.keyCode == 40) {
				keyfor(0,1,4);
				if(end()) {
					alert("game over");
				}else{
					var fif = rand(0, 15);
					while(arr1[fif] == true) {
						var fif = rand(0, 15);
					}
					box[fif].style.display = "block";
					box[fif].innerHTML = arr2[rand(0, 1)];
				}
			}
		}
		function keyfor(x,y,z){
			for(var i = x; i < x+3*y+1; i = i + y) {
					for(j = 1; j < 4; j++) {
						arrfu()
						if(!arr1[i + 3*z]) {
							box[i + 3*z].style.display = box[i + 2*z].style.display;
							box[i + 2*z].style.display = box[i + z].style.display;
							box[i + z].style.display = box[i].style.display;
							box[i].style.display = "none";
							box[i + 3*z].innerHTML = box[i + 2*z].innerHTML;
							box[i + 2*z].innerHTML = box[i + z].innerHTML;
							box[i + z].innerHTML = box[i].innerHTML;
							box[i].innerHTML = "";
						} else if(!arr1[i + 2*z]) {
							box[i + 2*z].style.display = box[i + z].style.display;
							box[i + z].style.display = box[i].style.display;
							box[i].style.display = "none";
							box[i + 2*z].innerHTML = box[i + z].innerHTML;
							box[i + z].innerHTML = box[i].innerHTML;
							box[i].innerHTML = "";
						} else if(!arr1[i + z]) {
							box[i + z].style.display = box[i].style.display;
							box[i].style.display = "none";
							box[i + z].innerHTML = box[i].innerHTML;
							box[i].innerHTML = "";
						} else {
							box[i].style.display = box[i].style.display;
							box[i].innerHTML = box[i].innerHTML;
						}
					}
					if(box[i + 3*z].innerHTML == box[i + 2*z].innerHTML) {
						if(box[i+z].innerHTML==box[i].innerHTML&&box[i].innerHTML!=0&&box[i+3*z].innerHTML!=0){
							box[i + 3*z].innerHTML = Number(box[i + 3*z].innerHTML) * 2;
							box[i + 2*z].innerHTML = Number(box[i + z].innerHTML) * 2;
							box[i+z].style.display = "none";
							box[i].style.display = "none";
							box[i+z].innerHTML = "";
							box[i].innerHTML = "";
						}else{
							box[i + 3*z].innerHTML = Number(box[i + 3*z].innerHTML) * 2;
							box[i + 2*z].innerHTML = box[i + z].innerHTML;
							box[i + z].innerHTML = box[i].innerHTML;
							box[i + 2*z].style.display = box[i + z].style.display;
							box[i + z].style.display = box[i].style.display;
							box[i].style.display = "none";
						}
						continue;
					} else if(box[i + 2*z].innerHTML == box[i + z].innerHTML) {
						box[i + 2*z].innerHTML = Number(box[i + 2*z].innerHTML) * 2;
						box[i + z].innerHTML = box[i].innerHTML;
						box[i + z].style.display = box[i].style.display;
						box[i].style.display = "none";
						continue;
					} else if(box[i + z].innerHTML == box[i].innerHTML) {
						box[i + z].innerHTML = Number(box[i + z].innerHTML) * 2;
						box[i].style.display = "none";
						continue;
					}
				}
		}
	</script>
	</body>
</html>